<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
<title>hcapi. hcapi3 3.8</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="author" content="">

<link href="css/bootstrap.css" rel="stylesheet">
<link href="css/bootstrap-responsive.css" rel="stylesheet">
<link href="css/highlight.css" rel="stylesheet">
<link href="css/staticdocs.css" rel="stylesheet">

<!--[if lt IE 9]>
  <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
<![endif]-->

<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });
</script>
<script type="text/javascript"
  src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>
  </head>

  <body>
    <div class="navbar">
  <div class="navbar-inner">
    <div class="container">
      <a class="brand" href="#">hcapi3 3.8</a>
      <div class="nav">
        <ul class="nav">
          <li><a href="index.html"><i class="icon-home icon-white"></i> Index</a></li>
        </ul>
      </div>
    </div>
  </div>
</div>

    <div class="container">
      <header>
        
      </header>
      
      <h1>Query, subset, summarize, and download HarvestChoice indicators</h1>

<div class="row">
  <div class="span8">
    <h2>Usage</h2>
    <pre><div>hcapi(var, iso3&nbsp;=&nbsp;"SSA", by&nbsp;=&nbsp;NULL, wkt&nbsp;=&nbsp;NULL, format&nbsp;=&nbsp;NULL, ...)</div></pre>
    
    <h2>Arguments</h2>
    <dl>
      <dt>var</dt>
      <dd>character array of variable codes, passed to <code><a href='getLayer.html'>getLayer</a></code></dd>
      <dt>iso3</dt>
      <dd>character array of ISO3 country or region codes, passed to <code><a href='getLayer.html'>getLayer</a></code></dd>
      <dt>by</dt>
      <dd>character array of variable codes to summarize by, passed to <code><a href='getLayer.html'>getLayer</a></code></dd>
      <dt>wkt</dt>
      <dd>WKT representation of a spatial object (points, multipoints, or polygons, multipolygons)</dd>
      <dt>format</dt>
      <dd>output format, one of "data.table", "csv", "tif", "dta", "asc", "grd", "rds",
else "png" to plot the rasters, or "hist" to plot histogram and univariate statistics</dd>
      <dt>...</dt>
      <dd>other optional arguments passed to <code><a href='getLayer.html'>getLayer</a></code>, <code><a href='genFile.html'>genFile</a></code>,
or to <code><a href='genPlot.html'>genPlot</a></code>, e.g. <code>collapse</code>, <code>as.class</code>, <code>dir</code>, <code>pal</code>.</dd>
    </dl>
    
    <div class="Value">
      <h2>Value</h2>

      <p><dl>
a data.table (or other formats) of <code>var</code> indicators summarized by <code>by</code> domains
</dl></p>
  
    </div>

    <div class="Description">
      <h2>Description</h2>

      <p>Wrapper method to query, subset and/or aggregate HarvestChoice layers.
This method may also be used to summarize classified variables along continuous
variables, e.g. <code>hcapi(var="AEZ16_CLAS", by="bmi")</code>. Here <code>AEZ16_CLAS</code> is
a classified (categorical) raster, and <code>bmi</code> is a continuous raster, but the
request is valid. The dominant class of <code>AEZ16_CLAS</code> is returned along intervals
of <code>bmi</code>. Default interval breaks are used but custom intervals may also be
defined, e.g. <code>hcapi(var="AEZ16_CLAS", by=list(bmi=c(0,5,10,15,20,25)))</code>.
The dominant class of a variable <code>var</code> is defined by <code><a href='dominant.html'>dominant</a>(var)</code>.
Layers may also be summarized over spatial points are areas (passed as WKT representations
using argument <code>wkt</code>). Use the <code>format</code> argument to control the output
format (see examples below).</p>
  
    </div>

    <div class="Details">
      <h2>Details</h2>

      <p>API call: mean body mass index and cassava yield across provinces and districts of
Tanzania</p>
  
      <p><code>$ curl http://hcapi.harvestchoice.org/ocpu/library/hcapi3/R/hcapi \
 -d '{"var":"cass_y", "iso3":"CIV", "format":"tif"}' \
 -X POST -H 'Content-Type:application/json'
--
/ocpu/tmp/x0bc1ac9bdf/R/.val
/ocpu/tmp/x0bc1ac9bdf/stdout
/ocpu/tmp/x0bc1ac9bdf/warnings
/ocpu/tmp/x0bc1ac9bdf/source
/ocpu/tmp/x0bc1ac9bdf/console
/ocpu/tmp/x0bc1ac9bdf/info
/ocpu/tmp/x0bc1ac9bdf/files/bmi--TZA.tfw
/ocpu/tmp/x0bc1ac9bdf/files/bmi--TZA.tif
/ocpu/tmp/x0bc1ac9bdf/files/bmi--TZA.tif.aux.xml
/ocpu/tmp/x0bc1ac9bdf/files/DESCRIPTION
/ocpu/tmp/x0bc1ac9bdf/files/README
</code></p>
  
      <p>GET all generated files in a ZIP archive</p>
  
      <p><code>$ wget http://hcapi.harvestchoice.org/ocpu/tmp/x0bc1ac9bdf/zip
</code></p>
  
      <p>API call: the method may be expanded to summarize classified (discrete) variables
along continuous variables. For example the call below returns the dominant
agro-ecological zone and average stunting in children under 5 over Ethiopia's
provinces and generic elevation zones</p>
  
      <p><code>$ curl http://hcapi.harvestchoice.org/ocpu/library/hcapi3/R/hcapi/json \
 -d '{"var":["AEZ8_CLAS","stunted_moderate"], "iso3":"ETH", "by":["ADM1_NAME_ALT","ELEVATION"]}' \
 -X POST -H 'Content-Type:application/json'
</code></p>
  
    </div>
    
    <h2 id="examples">Examples</h2>
    <pre class="examples"><div class='input'># Mean body mass index and cassava yield across provinces and districts of Tanzania
x &lt;- hcapi(c(&quot;bmi&quot;, &quot;cass_y&quot;), iso3=&quot;TZA&quot;, by=c(&quot;ADM1_NAME_ALT&quot;, &quot;ADM2_NAME_ALT&quot;))
x
</div>
<div class='output'>     ISO3                   ADM0_NAME     ADM1_NAME_ALT   ADM2_NAME_ALT  bmi cass_y
  1:  TZA United Republic of Tanzania            Arusha         Arumeru 21.2    NaN
  2:  TZA United Republic of Tanzania            Arusha          Arusha 22.2    NaN
  3:  TZA United Republic of Tanzania            Arusha          Karatu 21.2    NaN
  4:  TZA United Republic of Tanzania            Arusha         Monduli 21.2    NaN
  5:  TZA United Republic of Tanzania            Arusha      Ngorongoro 21.2    NaN
 ---                                                                               
124:  TZA United Republic of Tanzania      Unguja North         North B 21.7    NaN
125:  TZA United Republic of Tanzania      Unguja South         Central 22.9    NaN
126:  TZA United Republic of Tanzania      Unguja South           South 23.2    NaN
127:  TZA United Republic of Tanzania Unguja Urban West            West 23.2    NaN
128:  TZA United Republic of Tanzania   buffer gridcell buffer gridcell  NaN    NaN
</div>
<div class='input'>
# Plot results for Mara province
require(lattice)
barchart(ADM2_NAME_ALT~bmi, data=x[ADM1_NAME_ALT==&quot;Mara&quot;], col=&quot;grey90&quot;)

# Mean cassava yield in Ivory Coast in GeoTIFF raster format
x &lt;- hcapi(&quot;cass_y&quot;, iso3=&quot;CIV&quot;, format=&quot;tif&quot;)
</div>
<p><img src='hcapi-4.png' alt='' width='540' height='400' /></p>
<div class='input'>x
</div>
<div class='output'>[1] &quot;./hcapi-civ-cass_y.tfw&quot;         &quot;./hcapi-civ-cass_y.tif&quot;        
[3] &quot;./hcapi-civ-cass_y.tif.aux.xml&quot; &quot;./meta.csv&quot;                    
[5] &quot;./README.md&quot;                    &quot;./datapackage.json&quot;            
</div>
<div class='input'>
# Plot the generated TIF raster (one band only)
require(raster)
plot(raster(x[2]))
</div>
<p><img src='hcapi-8.png' alt='' width='540' height='400' /></p>
<div class='input'>
# The method may be expanded to summarize classified (discrete) variables along continuous
# variables. For example the call below returns the dominant agro-ecological zone and
# average stunting in children under 5 over Ethiopia&#39;s provinces by elevation class
x &lt;- hcapi(c(&quot;AEZ8_CLAS&quot;, &quot;stunted_moderate&quot;), iso3=&quot;ETH&quot;, by=c(&quot;ADM1_NAME_ALT&quot;, &quot;ELEVATION&quot;))
x
</div>
<div class='output'>    ISO3 ADM0_NAME     ADM1_NAME_ALT     ELEVATION           AEZ8_CLAS stunted_moderate
 1:  ETH  Ethiopia       Addis Ababa (2e+03,5e+03] Trp. Hld. Sub-Humid              0.0
 2:  ETH  Ethiopia              Afar            NA                Arid             39.4
 3:  ETH  Ethiopia              Afar (3e+02,5e+02]                Arid             39.4
 4:  ETH  Ethiopia              Afar (5e+02,9e+02]           Semi-Arid             39.4
 5:  ETH  Ethiopia              Afar (9e+02,1e+03]           Semi-Arid             40.3
 6:  ETH  Ethiopia              Afar (1e+03,2e+03] Trp. Hld. Semi-Arid             39.4
 7:  ETH  Ethiopia              Afar (2e+03,5e+03] Trp. Hld. Semi-Arid             39.4
 8:  ETH  Ethiopia            Amhara (5e+02,9e+02]           Semi-Arid             42.3
 9:  ETH  Ethiopia            Amhara (9e+02,1e+03]           Semi-Arid             42.3
10:  ETH  Ethiopia            Amhara (1e+03,2e+03] Trp. Hld. Semi-Arid             42.2
11:  ETH  Ethiopia            Amhara (2e+03,5e+03] Trp. Hld. Sub-Humid             42.2
12:  ETH  Ethiopia Benishangul Gumuz (5e+02,9e+02]           Sub-Humid             41.1
13:  ETH  Ethiopia Benishangul Gumuz (9e+02,1e+03]           Sub-Humid             40.2
14:  ETH  Ethiopia Benishangul Gumuz (1e+03,2e+03] Trp. Hld. Sub-Humid             40.3
15:  ETH  Ethiopia Benishangul Gumuz (2e+03,5e+03] Trp. Hld. Sub-Humid             37.4
16:  ETH  Ethiopia         Dire Dawa (9e+02,1e+03]           Semi-Arid             12.9
17:  ETH  Ethiopia         Dire Dawa (1e+03,2e+03] Trp. Hld. Semi-Arid             11.8
18:  ETH  Ethiopia         Dire Dawa (2e+03,5e+03] Trp. Hld. Semi-Arid             12.3
19:  ETH  Ethiopia          Gambella (3e+02,5e+02]           Sub-Humid             20.7
20:  ETH  Ethiopia          Gambella (5e+02,9e+02]           Sub-Humid             20.7
21:  ETH  Ethiopia          Gambella (9e+02,1e+03]           Sub-Humid             20.7
22:  ETH  Ethiopia          Gambella (1e+03,2e+03]           Sub-Humid             20.7
23:  ETH  Ethiopia            Harari (9e+02,1e+03] Trp. Hld. Semi-Arid             36.9
24:  ETH  Ethiopia            Harari (1e+03,2e+03] Trp. Hld. Semi-Arid             10.9
25:  ETH  Ethiopia            Oromia (3e+02,5e+02]           Semi-Arid             36.9
26:  ETH  Ethiopia            Oromia (5e+02,9e+02]           Semi-Arid             36.9
27:  ETH  Ethiopia            Oromia (9e+02,1e+03]           Semi-Arid             36.8
28:  ETH  Ethiopia            Oromia (1e+03,2e+03] Trp. Hld. Sub-Humid             36.7
29:  ETH  Ethiopia            Oromia (2e+03,5e+03] Trp. Hld. Sub-Humid             36.7
30:  ETH  Ethiopia              SNNP (3e+02,5e+02]           Sub-Humid             38.4
31:  ETH  Ethiopia              SNNP (5e+02,9e+02]           Sub-Humid             38.4
32:  ETH  Ethiopia              SNNP (9e+02,1e+03]           Sub-Humid             38.4
33:  ETH  Ethiopia              SNNP (1e+03,2e+03] Trp. Hld. Sub-Humid             38.3
34:  ETH  Ethiopia              SNNP (2e+03,5e+03]     Trp. Hld. Humid             38.2
35:  ETH  Ethiopia            Somali            NA                Arid             19.7
36:  ETH  Ethiopia            Somali (3e+02,5e+02]                Arid             19.7
37:  ETH  Ethiopia            Somali (5e+02,9e+02]                Arid             20.4
38:  ETH  Ethiopia            Somali (9e+02,1e+03]           Semi-Arid             20.1
39:  ETH  Ethiopia            Somali (1e+03,2e+03] Trp. Hld. Semi-Arid             22.1
40:  ETH  Ethiopia            Somali (2e+03,5e+03] Trp. Hld. Semi-Arid             19.8
41:  ETH  Ethiopia            Tigray (5e+02,9e+02]           Semi-Arid             40.0
42:  ETH  Ethiopia            Tigray (9e+02,1e+03]           Semi-Arid             40.1
43:  ETH  Ethiopia            Tigray (1e+03,2e+03] Trp. Hld. Semi-Arid             40.0
44:  ETH  Ethiopia            Tigray (2e+03,5e+03] Trp. Hld. Semi-Arid             39.8
    ISO3 ADM0_NAME     ADM1_NAME_ALT     ELEVATION           AEZ8_CLAS stunted_moderate
</div>
<div class='input'>
# Mean harvested maize area summarized across a custom polygon
x &lt;- hcapi(var=&quot;maiz_h&quot;, wkt=&quot;POLYGON((-16.35819663578485006 15.36599264077935345,
-15.42501860768386379 15.69472580976947462, -15.11749403024149174 14.83577785208561117,
-16.13550642453347805 14.68731771125136376, -16.35819663578485006 15.36599264077935345))&quot;)
x
</div>
<div class='output'>   ISO3 maiz_h
1:  SEN    330
</div>
<div class='input'></div></pre>
  </div>
  <div class="span4">
    <!-- <ul>
      <li>hcapi</li>
    </ul>
    <ul>
      
    </ul> -->
      
    <h2>See also</h2>
    
<a href='getLayer.html'>getLayer</a> <a href='getLayerWKT.html'>getLayerWKT</a> <a href='genFile.html'>genFile</a>

        
  </div>
</div>
      
      <footer>
      <p class="pull-right"><a href="#">Back to top</a></p>
<p>Built by <a href="https://github.com/hadley/staticdocs">staticdocs</a>. Styled with <a href="http://twitter.github.com/bootstrap">bootstrap</a>.</p>
      </footer>
    </div>
  </body>
</html>